---
title: "Figure set 10_3"
output:
  html_document: default
  pdf_document: default
---
10/4
Make plots with topo metrics, make final figure set to send to JP  

```{r global_options, include=FALSE}
#global settings
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r}
#Packages
library(tidyverse)
library(lubridate)
library(ggridges)
```

```{r}
#I need to make a data sheet that has one sensor per site
#in order to pull of the plots I want to make
temps <- read.csv("Tempswithdmetrics10_3.csv")
topo <- read.csv("topodata 10_4.csv")

#format time and other stuff
temps$rnd.dates <- ymd_hms(temps$rnd.dates)
temps <- temps %>% mutate_each(list(as.factor), sensor)
temps <- temps %>% mutate_each(list(as.character), site, type, shed)

temps.water <- filter(temps, type != "air")

temps.water <- filter(temps.water, site %in% c("ULB2HA", "ULB2CB","ULB3HA", "ULB3CB", "ULB4HA", "ULB4CA", "RMO1HA", "RMO1CB", "RMO2HA", "RMO2CB", "RMO3HB", "RMO3CB","MUL2HA", "MUL2CB", "MUL4HB", "MUL4CA", "MUL7HB", "MUL7CA","W600B", "W400A", "GC300B","GC100B", "LS180B", "LS0B"))

temps.water$site <- gsub('.{2}$', '', temps.water$site)

temps.water <- temps.water %>%
  mutate(type = replace(type, type == "channel", "Downstream"),
         type = replace(type, type == "head", "Head"),
         site = replace(site, site == "W60", "Wind"),
         site = replace(site, site == "W40", "Wind"),
         site = replace(site, site == "GC10", "Glac"),
         site = replace(site, site == "GC30", "Glac"),
         site = replace(site, site == "LS", "Land"),
         site = replace(site, site == "LS18", "Land"))

topo <- topo %>% mutate_each(list(as.character), Site, type, Shed)
topo <- topo %>% 
  select(Site, type, Slope..percent.rise., Elevation..ft., UAA..ft2.) %>% 
  rename(site = Site)
topo <- topo %>%
  mutate(type = replace(type, type == "Down", "Downstream"),
         type = replace(type, type == "head", "Head"),
         site = replace(site, site == "W600", "Wind"),
         site = replace(site, site == "W400", "Wind"),
         site = replace(site, site == "GC100", "Glac"),
         site = replace(site, site == "GC300", "Glac"),
         site = replace(site, site == "LS0", "Land"),
         site = replace(site, site == "LS180", "Land"))
#selecting sites, renaming one of the columns in the same function

#combine the datasets by Site and type
comb <- left_join(temps.water, topo, by = c("site", "type"))
```

Plot time  
Temperatures vary with Elevation  
```{r}
#making plots
#Elevation vs distribution
elevators <- ggplot(data = comb, 
                    aes(x = fct_reorder(site, Elevation..ft.),
                        y = Value,
                        fill = type))+
  theme_classic()+
  labs(x = "Elevation",
       y = "WaterT (C)")+
  scale_x_continuous()+
  geom_boxplot()

elevator.ridge <- ggplot(data = comb,
                         aes(x = Value,
                             y = fct_reorder(site, Elevation..ft.),
                             fill = type))+
  geom_density_ridges2(mapping = aes(scale=1))+
  theme_classic()+
  theme(axis.title.y= element_blank(),
        axis.title.x=element_text(size = 17),
        axis.ticks.y=element_blank(),
        strip.text.y = element_text(angle = 180, hjust = 1),
        line = element_blank(),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))+
  scale_y_discrete(expand = c(0.001, 0))+
  scale_x_continuous(limits = c(8,20), expand = c(0.001, 0))+
  xlab("Temp (C)")
elevators
elevator.ridge
```

Air temp plots  

```{r}
#Before I can plot airT stuff I need to get some kind of AirT data into my df
#comine datasets by time and shed
temps.air <- filter(temps, type == "air")

temps.air <- temps.air %>% mutate_each(list(as.character), site, type, shed)
temps.air <- temps.air %>% 
  select(shed, Value, rnd.dates, d.mean, d.min, d.max, d.sd) %>% 
  rename(airT = Value, air.d.mean = d.mean, air.d.min = d.min, air.d.max = d.max, air.d.sd = d.sd)

#brush is the new master datasheet
brush <- left_join(comb, temps.air, by = c("shed", "rnd.dates"))

#making summary df
presump <- brush %>% select(-X, -sensor, -shed, -day, -numb, -A.B, -rnd.dates)
shed.presump <- brush %>% select(site, shed) %>% distinct()

sump <- presump %>% group_by(site, type) %>% summarise_each(list(mean))

sump <- left_join(sump, shed.presump, by = c("site"))
```
As drainage area increases, average waterT increases  
```{r}
#plots with sump
#plotting uaa vs avg water T
drain.d <- filter(sump, type )

drain <- ggplot(sump, aes(x = UAA..ft2.,
                           y = Value,
                           color = shed,
                           ))+
  geom_point(aes(shape = type), size = 4)+
  geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+
  labs(x = "Drainage Area (ft^2)",
       y = "Average WaterT (C)")
drain
```
Slope has some kind of control on waterT  
```{r}
#plotting slope vs avg water T
steep <- ggplot(sump, aes(x = Slope..percent.rise.,
                          y = Value,
                          color = shed))+
  geom_point(aes(shape = type), size = 4)+
  geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+
  labs(x = "Slope (%)",
       y = "Average WaterT (C)")
steep
```
Water temperatures at downstream sites vary with AirT, but water temperatures at head sites do not vary with AirT  
```{r}
#airT vs WaterT
brush.h <- filter(brush, type == "Head")
heady <- ggplot(brush.h, aes(x = airT,
                          y = Value,
                          color = shed))+
  geom_point(size = 1,
             alpha = 0.25)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+
  labs(x = "Average airT (C)",
       y = "Average WaterT (C)",
       title = "Head sites")

#downstream sites
brush.d <- filter(brush, type == "Downstream")
downy <- ggplot(brush.d, aes(x = airT,
                          y = Value,
                          color = shed))+
  geom_point(size = 1,
             alpha = 0.25)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+
  labs(x = "Average airT (C)",
       y = "Average WaterT (C)",
       title = "Downstream sites")

downy
heady
```

Make new plots that I talked about with JP
```{r}
trug <- ggplot(comb, 
               aes(x = Elevation..ft.,
                   y = Value,
                   group = site))+
  geom_boxplot(aes(fill = type)
                   )+
  theme_classic()+
  labs(x = "Elevation",
       y = "WaterT (C)")
  #scale_x_continuous()+
  
trug

#group = cut_interval(Elevation..ft., length = 1))

ggplot(data = NDVI_ts, aes(x = date, y = NDVI)) +
  geom_boxplot(aes(fill = interaction(Trial.group, Treatment),
                   group = interaction(factor(date), Trial.group, Treatment))) + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_date(breaks = "1 week", labels = date_format("%d-%b")) +
  scale_fill_manual(name = "Treatment",
                    values = c("#FEE0D2", "#DE2D26", "#DEEBF7", "#3182BD"))
```

10/24- Going to stop banging my head against the wall about the boxplot issue, try to get some of the other plots put together

use average slope and average elevation to make plots- need to combine the data sheets i made
```{r}
#reading in data sheets within the folder
mose <- read.csv("shed data 10_11/shed data 10_11/moselevstats.csv", header = T, sep = ",")
mule <- read.csv("shed data 10_11/shed data 10_11/mulelevstats.csv", header = T, sep = ",")
ids <- read.csv("shed data 10_11/shed data 10_11/slopeids.csv", header = T, sep = ",")
stats <- read.csv("shed data 10_11/shed data 10_11/slopestats.csv", header = T, sep = ",")
ulbe <- read.csv("shed data 10_11/shed data 10_11/ulbelevstats.csv", header = T, sep = ",")

#combine the data sets
#format the "master" sheet- ids
ids <- select(ids, Site, type, pour_ord)
stats <- select(stats, -OBJECTID, -COUNT, -RANGE, -SUM, -AREA)%>% 
  rename(pour_ord = VALUE)
mose <- select(mose, -OBJECTID, -COUNT,  -RANGE, -SUM)%>%
  rename(pour_ord = VALUE)
mule <- select(mule, -OBJECTID, -COUNT,  -RANGE, -SUM)%>%
  rename(pour_ord = VALUE)
ulbe <- select(ulbe, -OBJECTID, -COUNT,  -RANGE, -SUM)%>%
  rename(pour_ord = VALUE)

#make new frame with all of the new data
bug <- left_join(ids, stats, by = "pour_ord")%>%
  rename(slope.min = MIN, slope.max = MAX, slope.mean = MEAN, slope.sd = STD)%>%
  mutate_each(list(as.character), Site, type)%>%
  mutate(type = replace(type, type == "Down", "Downstream"))

gut <- bind_rows(mose, mule, ulbe)
buggy <- left_join(bug, gut, by = "pour_ord")%>%
  rename(elev.min = MIN, elev.max = MAX, elev.mean = MEAN, elev.sd = STD)

#changed the name of GG sites
buggy <- buggy %>%
  mutate(Site = replace(Site, Site == "W600", "Wind"),
         Site = replace(Site, Site == "W400", "Wind"),
         Site = replace(Site, Site == "GC100", "Glac"),
         Site = replace(Site, Site == "GC300", "Glac"),
         Site = replace(Site, Site == "LS0", "Land"),
         Site = replace(Site, Site == "LS180", "Land"
         ))

#add new frame with topo metrics to master data frame from before
crat <- select(comb, -X, -sensor, -numb, -day)%>%
  rename(Site = site)
buggy <- buggy %>% mutate_each(list(as.character), Site, type)
crater <- inner_join(crat, buggy, by = c("Site", "type"))
```

Crater is the one- time to make some sick plots based off of it
```{r}
#Mean T vs size/elev
crater <- mutate(crater, size.elev = AREA/elev.mean, elev.size = elev.mean/AREA)

gronk1 <- ggplot(crater, aes(y = d.mean,
                             x = size.elev,
                             color = shed,
                             shape = type))+
  geom_point(aes(),
                 size = 2)+
  geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+
  xlab("area(ft2) / avg elev (ft)")
gronk1

gronk2 <- ggplot(crater, aes(y = d.mean,
                             x = elev.mean,
                             color = shed,
                             shape = type))+
  geom_point(aes(),
                 size = 2)+
  geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+
  xlab("avg elev (ft)")
gronk2

gronk3 <- ggplot(crater, aes(y = d.mean,
                             x = AREA,
                             color = shed,
                             shape = type))+
  geom_point(aes(),
                 size = 2)+
  geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+
  xlab("area(ft2)")
gronk3
```

```{r}
gronk2 <- ggplot(crater)+
  geom_point(aes(x = d.mean,
                 y = elev.size,
                 color = shed,
                 shape = ))+
  theme_classic()+
  ylab("avg elev (ft) / area(ft2)")
gronk2
```
```{r}
gronk3 <- ggplot(crater)+
  geom_point(aes(x = d.sd,
                 y = elev.size,
                 color = shed,
                 shape = ))+
  theme_classic()+
  ylab("avg elev (ft) / area(ft2)")
gronk3
```
```{r}
gronk4 <- ggplot(crater)+
  geom_point(aes(y = d.sd,
                 x = size.elev,
                 color = shed,
                 shape = ))+
  theme_classic()+
  xlab("area(ft2) / avg elev (ft)")
gronk4
```
```{r}
#are downstream sites more related to heads or elev, slope, uaa?
d.crater <- filter(crater, type != "Downstream")
```

