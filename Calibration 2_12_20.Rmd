---
title: "ReCalibration 2_10"
output: html_document
---

```{r global_options, include=FALSE}
#global settings
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r, include = FALSE}
#Packages
library(tidyverse)
library(lubridate)
library(SAVER)
```

2/11
Performed more robust calibration method, now need to produce calibration curves and apply to the correct sensors

workflow:
-download and read in data using old code
-devise a way to incorporate actual temps into df
-use obs vs act for each sensor to run a linear regression
-save linear regression for each sensor
-apply linear regressions to the corresponding sensor data from summer deployment

```{r}
#read in data
#removed 15- ULB4HB- super messed up, sensor was broken
files <- list.files(path = "Calibration data 2_6_20/")
sites <- read.csv("site_temps_7_11.csv", header = T, sep = ",")
    sites$f.col.time <- mdy_hm(sites$collection.time)
    sites$f.dep.time <- mdy_hm(sites$deploy.time)
#read in all temps into one dataframe
for (i in 1:length(files)) {
    data <- read.csv(paste0("Calibration data 2_6_20/",
                            files[i]), 
                     skip = 19, 
                     header = T, sep = ",")
    #formatting time
    data$fdates <- mdy_hms(data$Date.Time)
    #making a column with sensor number
    data$sensor <- files[i]
    data$sensor <- gsub("data","\\1", data$sensor)
    data$sensor <- gsub(".csv","\\1", data$sensor)
    #making column with site loc
    #round temperatures to nearest tenth
    data$rnd.dates <- round_date(data$fdates, "5 minutes")
  
  if(i == 1)alldat <- data                 
  if(i > 1)alldat <- rbind(alldat, data)
}
#remove all temps that are not from 2-6-20
    #make column with day component
alldat$day <- day(alldat$rnd.dates)
#remove everything that wasn't on the 6th
obs <- filter(alldat, day == c("6"))
#remove values that aren't at the same time as actual measurements
act <- read.csv("measured temps 2_6.csv")
    #round times to the nearest 5 mins
act$time <- mdy_hm(act$time)
act$r.time <- round_date(act$time, unit = "5 minutes")
    #filter out values that are not within the calibration period
obs <- filter(obs, rnd.dates %in% act$r.time)
#add act measurements to obs
act1 <- select(act, digital, analog, r.time)
obs1 <- select(obs, Value, sensor, rnd.dates)%>%
  rename(r.time = rnd.dates)

comb <- left_join(obs1, act1, by = "r.time")

#run linear regressions
  #make for loop that runs linear regs for each sensor and produces a data frame with coefficients
#list of sensors
sensors <- unique(comb$sensor)
for(k in 1:length(sensors)){
  sensor <- sensors[k]
  df <- filter(comb, sensor == sensors[k])
  reg <- lm(Value ~ digital,
            data = df)
  r2 <- summary(reg)$r.squared
  co <- coefficients(reg)
  #output
  
  temp <- data.frame(sensor = sensor, r2 = r2, intercept = co[1], slope = co[2])
  if(k == 1) all <- temp
  if(k > 1) all <- rbind(all, temp)
}
row.names(all) <- 1:nrow(all)
calibrations <- all

#write.csv(calibrations, file = "calibrations.2_12_20.csv")
```

Successfully calculated curves to correct data, now need to apply corrections
```{r}
#read in og data
cali <- read.csv("calibrations.2_12_20.csv")
fog <- read.csv("Formatted.temps.tall_7_17.csv")

#remove sensor 138
cali <- filter(cali, sensor != "138")
#seeing which sensors I am missing
deployed <- unique(fog$sensor)
calibrated <- unique(cali$sensor)
diff <- setdiff(deployed, calibrated)

#deployed <- as.integer(unique(fog$sensor))
#calibrated <- as.integer(unique(cali$sensor))
#diff <- setdiff(deployed, calibrated)
#remove sensors I wasn't able to calibrate
fog1 <- filter(fog, sensor %in% calibrated)
#add coeffs to data
cali.fog <- inner_join(fog, cali, by = "sensor")
#create column of corrected values
cali.fog$temp.cor <- ((cali.fog$Value * cali.fog$slope) + cali.fog$intercept)

cali.fog.dayz <- select(cali.fog, temp.cor, rnd.dates, site, type, shed)
cali.fog.dayz$rnd.dates <- ymd_hms(cali.fog.dayz$rnd.dates)

#write.csv(cali.fog.dayz, file = "unformatted_data.3_25.csv")
```

```{r}
#Checking data 
GG <- filter(cali.fog.dayz, shed == "GG")
#remove one LS and one wind- cant tell which is which
ULB <- filter(cali.fog.dayz, shed == "ULB")
#remove 3CB
RMO <- filter(cali.fog.dayz, shed == "RMO")
#remove 2CA
MUL <- filter(cali.fog.dayz, shed == "MUL")

double <- c("LS180A", "LS180B", "GC300B", "W600A", "W600B")

GG1 <- filter(cali.fog.dayz, site %in% double)

ggplot(GG1, aes(x = rnd.dates, y = temp.cor))+
  geom_line(aes(color = site))+
  theme_classic()
```

```{r}
thechosen <- c("W600B", "LS180A", "W400A", "GC100B", "LS0A", "MUL2HA", "RMO1HA", "RMO2CB", "RMO2HA", "ULB3CA" )
```


Basic time series- What I actually did before to process the data
```{r}
#formatting time to beginning and end of deployment period
#start <- mdy_hm("6-25-19 12:10")
#end <- mdy_hm("7-5-19 12:10")
#timeseries <- filter(cali.fog.dayz, rnd.dates >= start)
#timeseries <- filter(cali.fog.dayz, rnd.dates <=

cali.fog.dayz <- pot

ULB <- filter(cali.fog.dayz, shed == "ULB")
ulb.sites <- unique(ULB$site)
GG <- filter(cali.fog.dayz, shed == "GG")
gg.sites <- unique(GG$site)
RMO <- filter(cali.fog.dayz, shed == "RMO")
rmo.sites <- unique(RMO$site)
MUL <- filter(cali.fog.dayz, shed == "MUL")
mul.sites <- unique(MUL$site)


gg.char <- as.character(gg.sites)
ulb.char <- as.character(ulb.sites)
rmo.char <- as.character(rmo.sites)
mul.char <- as.character(mul.sites)
all.ts <- c(gg.char, ulb.char, rmo.char, mul.char)

#selecting duplicates that I want to remove
the.un.chosen <- c("W600A", "LS180B", "W400B", "GC100A", "GC300B", "LS0B", "MUL2HB", "RMO1HB", "RMO2CA", "RMO2HB", "ULB3CB" )

thechosen <- setdiff(all.ts, the.un.chosen)
#for initial assessment  

timeseries <- cali.fog.dayz %>% filter(site %in% thechosen)
timeseries$site <- gsub('.{1}$', '', timeseries$site)
timeseries$site <- gsub('.{1}$', '', timeseries$site)

feed <- timeseries %>% mutate_each(list(as.character), site, type, shed)
feedy <- feed %>%
  mutate(type = replace(type, type == "channel", "Downstream"),
         type = replace(type, type == "head", "Head"),
         site = replace(site, site == "W60", "Wind"),
         site = replace(site, site == "W40", "Wind"),
         site = replace(site, site == "GC10", "Glac"),
         site = replace(site, site == "GC30", "Glac"),
         site = replace(site, site == "LS", "Land"),
         site = replace(site, site == "LS18", "Land"))

#Before I can plot airT stuff I need to get some kind of AirT data into my df
#comine datasets by time and shed
temps.air <- filter(feedy, type == "air") %>% 
  select(shed, temp.cor, rnd.dates) %>% 
  rename(airT = temp.cor)

doob <- filter(feedy, type != "air")

#brush is the new master datasheet
brush <- left_join(doob, temps.air, by = c("shed", "rnd.dates"))
#read in topo metrics attached to old data
dogg <- read.csv("Tempsanddata_11_8.csv")
dg <- select(dogg, Site, type, UAA..ft2., slope.mean, elev.mean)%>%
  rename(site = Site)
yg <- unique(dg)
row.names(yg) <- 1:nrow(yg)
#removing the duplicate mul2
ug <- slice(yg, -7)%>%
  select(-type)%>%
  mutate_each(list(as.character), site)

#brush includes downstream temps
rug <- filter(brush, type == "Downstream")%>%
  select(temp.cor, rnd.dates, site)%>%
  rename(downT = temp.cor)
hug <- filter(brush, type == "Head")

#testing trying to figure out what is happening
test <- filter(rug, rnd.dates == "2019-06-15 10:10:00")
#need to join topo from ug, downstream temps from rug, everything from hug
hugrug <- left_join(hug, rug, by = c("site", "rnd.dates"))
hugrugug <- left_join(hugrug, ug, by = c("site"))

#write.csv(hugrugug, file = "cor_data_and_topo_3_9.csv")

ulb.ts <- brush %>% filter(shed == "ULB")
mul.ts <- brush %>% filter(shed == "MUL")
rmo.ts <- brush %>% filter(shed == "RMO")
gg.ts <- brush %>% filter(shed == "GG")
#ulb
rmo.ts.plot <- ggplot(data = rmo.ts)+
  geom_line(aes(x = rnd.dates,
                y = temp.cor,
                
                color = site,
                linetype = type), 
            size = 1)+
  scale_linetype_manual(labels = c( "Downstream","Head"),
                        values=c("solid", "dotted"),
                        name = "Location")+
   scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  xlab(" ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))
rmo.ts.plot
#rmo
ulb.ts.plot <- ggplot(data = ulb.ts)+
  geom_line(aes(x = rnd.dates,
                y = temp.cor,
                color = site,
                linetype = type), 
            size = 1.5)+
  scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  scale_linetype_manual(values=c("solid", "dotted"),
                        name = "Location",
                        labels = c("Downstream", "Head"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))+
  guides(color = guide_legend(order = 1), 
              linetype = guide_legend(order = 2))
ulb.ts.plot 
#mul
mul.ts.plot <- ggplot(data = mul.ts)+
  geom_line(aes(x = rnd.dates,
                y = temp.cor,
                color = site,
                linetype = type), 
            size = 1.5)+
  scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  scale_linetype_manual(values=c( "dotted","solid"),
                        name = "Location",
                        labels = c("Head", "Downstream"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))
mul.ts.plot
#gg
gg.names <- data.frame("names" =c("Wind","Glacier", "Glacier","Landslide","Wind","Landslide"), 
                       "site" = c("W40","GC10","GC30","LS18","W60","LS"))
gg.ts <- gg.ts %>% inner_join(gg.names, brush, by = "site")

gg.ts.plot <- ggplot(data = gg.ts, aes(x = rnd.dates,
                y = temp.cor,
                color = site))+
  geom_line(aes(linetype = type), size = 1.5)+
  scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  scale_linetype_manual(values=c("solid", "dotted"),
                        name = "Location",
                        labels = c("Downstream", "Head"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))
gg.ts.plot




#ggsave("ulb.ts.png", plot = ulb.ts.plot, width = 8, height = 5, units = c("in"))
#ggsave("mul.ts.png", plot = mul.ts.plot, width = 8, height = 5, units = c("in"))
#ggsave("rmo.ts.png", plot = rmo.ts.plot, width = 8, height = 5, units = c("in"))
#ggsave("gg.ts.png", plot = gg.ts.plot, width = 8, height = 5, units = c("in"))

```

```{r}
#making plots for story board
#use "cor_data_and_topo_2_19.csv"
pot <- read.csv("cor_data_and_topo_3_9.csv")
pot$rnd.dates <- ymd_hms(pot$rnd.dates)

#adding averages
pote <- pot%>%
  group_by(site)%>%
  summarise(avg.headtemp = mean(temp.cor, na.rm = TRUE), 
            avg.airtemp = mean(airT),
            med.headtemp = median(temp.cor, na.rm = TRUE),
            med.airtemp = median(airT))

potet <- inner_join(pot, unique(pote), by = c("site"))%>%
  distinct()

#converting topo metrics to metrics
potet <- mutate(potet, elev.mean.meters = elev.mean * 0.3048,
               uaa.m2 = UAA..ft2. * 0.3048 * 0.3048)

format.potet <- select(potet, temp.cor, rnd.dates, site, type, shed, airT, downT, slope.mean, elev.mean.meters, uaa.m2, avg.headtemp, avg.airtemp, med.headtemp, med.airtemp)

#write.csv(format.potet, file = "data.for.analysis_3_9.csv")
#plot drainage area vs all temps
#outlier is probably ls- from spikes in temps that correspond with precip- remove them?
gronk1 <- ggplot(potet, aes(y = med.headtemp,
                             x = uaa.m2,
                             color = shed))+
  geom_point(aes(),
                 size = 4)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+

  xlab("drainage area (m2)")
gronk1

gronk1a <- ggplot(potet, aes(y = med.airtemp,
                             x = uaa.m2,
                             color = shed))+
  geom_point(aes(),
                 size = 4)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+

  xlab("drainage area (m2)")
gronk1a


#plot mean slope vs temps
gronk2 <- ggplot(potet, aes(y = med.headtemp,
                             x = slope.mean,
                             color = shed))+
  geom_point(aes(),
                 size = 4)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+

  xlab("slope (deg)")
gronk2

#plot mean elev vs temps
gronk3 <- ggplot(potet, aes(y = med.headtemp,
                             x = elev.mean.meters,
                             color = shed))+
  geom_point(aes(),
                 size = 4)+
  theme_classic()+
  scale_color_brewer(palette = "Dark2")+

  xlab("mean elev (m)")
gronk3

#how different are the median values from the mean values?
ggplot(potet, aes(x = avg.headtemp,
                  y = med.headtemp))+
  geom_point(aes(color = site), size = 2)+
  geom_abline(slope = 1, intercept = 0, color = "black")+
  theme_classic()
```

```{r}
theme_invis <- function (){
        theme(text= element_text(size=17),
        panel.background  = element_blank(),
        plot.background = element_rect(fill="transparent", colour=NA),
        legend.background = element_rect(fill="transparent", colour=NA),
        legend.key = element_rect(fill="transparent", colour=NA),
        panel.border = element_blank(), panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), axis.line = element_line(colour = "black", 
                size = rel(1)))
}

shed.breaks <- c("GG","ULB","RMO","MUL")
shed.colors <- c("firebrick4","slateblue4","sienna2","seagreen1")

#plotting slope vs avg water T
elev <- ggplot(potet, aes(x = elev.mean.meters,
                          y = med.headtemp,
                          color = shed))+
  geom_point(size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Mean Elevation (m)",
       y = "Median WaterT (C)")+
  scale_color_manual(breaks = shed.breaks,
                    values = shed.colors)
elev
#slope
slope <- ggplot(potet, aes(x = slope.mean,
                          y = med.headtemp,
                          color = shed))+
  geom_point(size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Mean Slope (%)",
       y = "Median WaterT (C)")+
  scale_color_manual(breaks = shed.breaks,
                    values = shed.colors)
slope
#drainage area
drain <- ggplot(potet, aes(x = uaa.m2,
                          y = med.headtemp,
                          color = shed))+
  geom_point(size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Drainage Area (m2)",
       y = "Median WaterT (C)")+
  scale_color_manual(breaks = shed.breaks,
                    values = shed.colors)
drain

ggsave(drain, filename = "Ctopoplot1.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))
ggsave(slope, filename = "Ctopoplot2.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))
ggsave(elev, filename = "Ctopoplot3.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))
```

```{r}
#make table of regression results for storyboard
all <- lm(avg.headtemp ~ uaa.m2 + elev.mean.meters + slope.mean, data = potet)
summary(all)

t <- lm(avg.headtemp ~ slope.mean, data = potet)
summary(t)

```
```{r}
#rate plots for storyboard
warm <- read.csv("straightlinerates11_8.csv")

rat <- select(warm, Site, straight.line.Dist.to.head.m)%>%
  rename(site = Site)%>%
  mutate_each(list(as.character), site)


rate <- left_join(potet, rat, by = "site")

ratet <- 
```

3/4/20
Figure out if the temperatures at Glacier are real
Compare to old data
```{r}
#use "data.for.analysis_3_4.csv"
potet <- read.csv("data.for.analysis_3_4.csv")

#read in old data
fall <- read.csv("GG Temperature Data Sheets/Falltempfinal.csv")
spring <- read.csv("GG Temperature Data Sheets/Springtempfinal.csv")

means <- c(mean(fall$GC0AF), mean(fall$GC0BF), mean(spring$GC0AS), mean(spring$GC0BS))
#find what airT is at the median
#df[which(df$Amount == min(df$Amount)), ]
airtFA <- mean(fall$AirTF[which(fall$GC0AF == median(fall$GC0AF))])
airtFB <- mean(fall$AirTF[which(fall$GC0BF == median(fall$GC0BF))])
airtSA <- mean(spring$AirTS[which(spring$GC0AS == median(spring$GC0AS))])
airtSB <- mean(spring$AirTS[which(spring$GC0BS == median(spring$GC0BS))])

airT <- c(airtFA, airtFB, airtSA, airtSB)
ID <- c("FA", "FB", "SA", "SB")
#df of mean water T at GC head, mean airT when the median temp occurs, and the time ID
GC.means <- data.frame(means, airT, ID)

#add summer deployment to data
GC.summer <- filter(potet, site == "Glac")
airtsum <- mean(GC.summer$airT[which(GC.summer$temp.cor == GC.summer$med.headtemp)])

#do it again but with summer deployment added
means <- c(mean(fall$GC0AF), mean(fall$GC0BF), mean(spring$GC0AS), 
           mean(spring$GC0BS), GC.summer$avg.headtemp[1])
airT <- c(airtFA, airtFB, airtSA, airtSB, airtsum)
ID <- c("FallA", "FallB", "SpringA", "SpringB","Summer")
GC.means <- data.frame(means, airT, ID)

#plot them all
gc.fall2017A <- select(fall, temptime, AirTF, GC0AF)%>%
  rename(datetime = temptime, airT = AirTF, headT = GC0AF)%>%
  mutate(deployment = "Fall 2017 A")
gc.spring2017A <- select(spring, temptime, AirTS, GC0AS)%>%
  rename(datetime = temptime, airT = AirTS, headT = GC0AS)%>%
  mutate(deployment = "Spring 2017 A")
#sensor Bs- went on to plot, A was weird for both
gc.fall2017B <- select(fall, temptime, AirTF, GC0BF)%>%
  rename(datetime = temptime, airT = AirTF, headT = GC0BF)%>%
  mutate(deployment = "Fall 2017 B")
gc.spring2017B <- select(spring, temptime, AirTS, GC0BS)%>%
  rename(datetime = temptime, airT = AirTS, headT = GC0BS)%>%
  mutate(deployment = "Spring 2017 B")

gc.summer2019 <- select(GC.summer, rnd.dates, airT, temp.cor)%>%
  rename(datetime = rnd.dates, headT = temp.cor)%>%
  mutate(deployment = "Summer 2019")

#format time column so that they bind smoothly- shouldve done this earlier in the code
gc.fall2017A$datetime <- mdy_hm(gc.fall2017A$datetime)
gc.spring2017A$datetime <- mdy_hm(gc.spring2017A$datetime)
gc.fall2017B$datetime <- mdy_hm(gc.fall2017B$datetime)
gc.spring2017B$datetime <- mdy_hm(gc.spring2017B$datetime)
gc.summer2019$datetime <- ymd_hms(gc.summer2019$datetime)

all.gc <- bind_rows(gc.spring2017A, gc.spring2017B, gc.fall2017A, gc.fall2017B, gc.summer2019)

ggplot(all.gc, aes(x = datetime))+
  geom_line(aes(y = headT, color = deployment))+
  geom_line(aes(y = airT, color = deployment), linetype = "dotted")+
  facet_wrap(deployment ~. , scales = "free_x")+
  theme_classic()+
  theme(legend.position = "none")
```

```{r}
#do the same thing but with wind
```

```{r}
#predict temps through time but with just one metric, and plot against airT- the r=adj r2 or the resid
#predict daily mean of head temp, using individual topo metrics
##actual code##
#using potet df

potet <- read.csv("data.for.analysis_3_9.csv")
potet$rnd.dates <- ymd_hms(potet$rnd.dates)
temps <- potet %>% mutate(day = floor_date(rnd.dates, "day"))

shack <- temps%>%
  group_by(site, day)%>%
  summarise(d.avg.headtemp = mean(temp.cor, na.rm = TRUE), 
            d.avg.airtemp = mean(airT),
            d.med.headtemp = median(temp.cor, na.rm = TRUE),
            d.med.airtemp = median(airT))
ungroup(shack)

#shack <- shack[complete.cases(shack),]

comb <- inner_join(temps, shack, by = c("site", "day"))%>%
  distinct()
#successfully added daily stats, now regress

#calculate lm for each day at each site
atak.day <- select(comb, -c(rnd.dates, temp.cor, airT, downT, avg.headtemp, avg.airtemp, med.headtemp, med.airtemp, X))
atak.day <- unique(atak.day)
#atak.day <- atak.day[complete.cases(atak.day),]

dayz <- select(atak.day, day)
dayzd <- unique(dayz)
dayzd$num <- 1:nrow(dayzd)

 daf <- dayzd$day[2]
  df <- filter(atak.day, day == daf)

for(k in 1:length(dayzd$num)){
  daf <- dayzd$day[k]
  df <- filter(atak.day, day == daf)
  #run a regression for each topo metric
  reg.elev <- lm(d.avg.headtemp ~ elev.mean.meters, data = df)
  reg.slope <- lm(d.avg.headtemp ~ slope.mean, data = df)
  reg.uaa <- lm(d.avg.headtemp ~ uaa.m2, data = df)
  #
  r2.elev <- summary(reg.elev)$r.squared
  r2.slope <- summary(reg.slope)$r.squared
  r2.uaa <- summary(reg.uaa)$r.squared
  co.elev <- coefficients(reg.elev)
  co.slope <- coefficients(reg.slope)
  co.uaa <- coefficients(reg.uaa)
  #output
  temp <- mutate(df,
                 r2.elev = r2.elev,
                 r2.slope = r2.slope,
                 r2.uaa = r2.uaa,
                 co.elev.int = co.elev[1],
                 co.elev = co.elev[2],
                 co.slope.int = co.slope[1],
                 co.slope = co.slope[2],
                 co.uaa.int = co.uaa[1],
                 co.uaa = co.uaa[2])
  if(k == 1) alldat <- temp
  if(k > 1) alldat <- rbind(alldat, temp)
}

agg <- alldat

#time to plot metrics r2 through time
agg.tall <- select(agg, site, shed, day, d.avg.airtemp, r2.elev,  r2.slope, r2.uaa, co.elev.int,      co.elev, co.slope.int, co.slope, co.uaa.int, co.uaa)%>%
   gather(key= "metric", value = "value", -site, -shed, -day, -d.avg.airtemp)

#problem with airT at RMO and MUL
unique((agg.tall.all$site[is.na(agg.tall.all$d.avg.airtemp)]))
#add uncorrected airT for these two
#read in uncorrected data
uncordata <- read.csv("Formatted.temps.tall_7_17.csv")
uncordata$rnd.dates <- ymd_hms(uncordata$rnd.dates)
uncordata.day <- uncordata %>% mutate(day = floor_date(rnd.dates, "day"))

#remove everything but site, Value
rmo.air <- filter(uncordata.day, site == "RMOAir")%>%
  select(Value, day, shed)%>%
  group_by(day)%>%
  summarise(d.avg.airtemp = mean(Value))
ungroup(rmo.air)

#now join airT from RMO to the full corrected data set

no.rmo.agg.tall <- filter(agg.tall, shed != "RMO")
rmo.agg.tall <- filter(agg.tall, shed == "RMO")%>%
  select(-d.avg.airtemp)

rmo.agg.tall.air <- left_join(rmo.agg.tall, rmo.air, by = "day")

agg.tall.all <- bind_rows(no.rmo.agg.tall, rmo.agg.tall.air)


#agg.tall.1 <- filter(agg.tall, site != "RMO2")%>%
#  filter(site != "RMO3")%>%
#  filter(site != "RMO1")%>%
#  filter(site != "MUL2")

ggplot(agg.tall.all, aes(x = d.avg.airtemp))+
  geom_point(aes(y = value, color = shed))+
  facet_wrap(metric ~., scales = "free_y")+
  theme_classic()

ggplot(agg.tall.all, aes(x = day))+
  geom_point(aes(y = value))+
  facet_wrap(metric ~., scales = "free_y")+
  theme_classic()

#write.csv(agg.tall.all, file = "pred.coeffs.3_11.csv")

#make finalized plot with r^2, and coefficients
r2.mets <- c("r2.elev", "r2.slope", "r2.uaa")
r2.data <- filter(agg.tall.all, metric %in% r2.mets)

r2.plot <- ggplot(r2.data, aes(x = d.avg.airtemp, 
                               y = value))+
  geom_point(aes(color = shed))+
  facet_wrap(metric ~.)+
  theme_classic()
r2.plot
```


3/8/20

Its time to finish the work
It is time to finish
It is time to stop

Going to look at ICP data, then make final plots, then that is it. No more anaylsis
```{r}
icp <- read.csv("ICP results.csv", 
                colClasses=c("integer", rep("factor", 5), rep("numeric", 10)))


icp[icp == "n.a."] <- NA

icp$sodium <- as.numeric(levels(icp$sodium))[icp$sodium]
icp <- filter(icp, type == "samp")%>%
  select(-No., -Name, -type, -date)%>%
  pivot_longer(cols = c(-shed, -site), names_to = "ions", values_to = "value")
#GG2 = GC, GG3 = LS

#make it tall


ggplot(icp, aes(site))+
  geom_bar()+
  theme_classic()
```

```{r}
#getting values of slope and stuff for my table of info
#use potet
pin <- select(potet, site, slope.mean, elev.mean.meters, uaa.m2)
pin <- unique(pin)

write.csv(pin, file = "topometsfortable.csv")
```

Basic time series
```{r}

cali.fog.dayz <- pot

ULB <- filter(cali.fog.dayz, shed == "ULB")
ulb.sites <- unique(ULB$site)
GG <- filter(cali.fog.dayz, shed == "GG")
gg.sites <- unique(GG$site)
RMO <- filter(cali.fog.dayz, shed == "RMO")
rmo.sites <- unique(RMO$site)
MUL <- filter(cali.fog.dayz, shed == "MUL")
mul.sites <- unique(MUL$site)


gg.char <- as.character(gg.sites)
ulb.char <- as.character(ulb.sites)
rmo.char <- as.character(rmo.sites)
mul.char <- as.character(mul.sites)
all.ts <- c(gg.char, ulb.char, rmo.char, mul.char)

#for initial assessment  

timeseries <- cali.fog.dayz %>% filter(site %in% one.each)

feed <- timeseries %>% mutate_each(list(as.character), site, type, shed)
feedy <- feed %>%
  mutate(type = replace(type, type == "channel", "Downstream"),
         type = replace(type, type == "head", "Head"),
         site = replace(site, site == "W60", "Wind"),
         site = replace(site, site == "W40", "Wind"),
         site = replace(site, site == "GC10", "Glac"),
         site = replace(site, site == "GC30", "Glac"),
         site = replace(site, site == "LS", "Land"),
         site = replace(site, site == "LS18", "Land"))

#Before I can plot airT stuff I need to get some kind of AirT data into my df
#comine datasets by time and shed
temps.air <- filter(feedy, type == "air") %>% 
  select(shed, temp.cor, rnd.dates) %>% 
  rename(airT = temp.cor)

doob <- filter(feedy, type != "air")

#brush is the new master datasheet
brush <- left_join(doob, temps.air, by = c("shed", "rnd.dates"))
#read in topo metrics attached to old data
dogg <- read.csv("Tempsanddata_11_8.csv")
dg <- select(dogg, Site, type, UAA..ft2., slope.mean, elev.mean)%>%
  rename(site = Site)
yg <- unique(dg)
row.names(yg) <- 1:nrow(yg)
#removing the duplicate mul2
ug <- slice(yg, -7)%>%
  select(-type)%>%
  mutate_each(list(as.character), site)

#brush includes downstream temps
rug <- filter(brush, type == "Downstream")%>%
  select(temp.cor, rnd.dates, site)%>%
  rename(downT = temp.cor)
hug <- filter(brush, type == "Head")

#testing trying to figure out what is happening
test <- filter(rug, rnd.dates == "2019-06-15 10:10:00")
#need to join topo from ug, downstream temps from rug, everything from hug
hugrug <- left_join(hug, rug, by = c("site", "rnd.dates"))
hugrugug <- left_join(hugrug, ug, by = c("site"))

#write.csv(hugrugug, file = "cor_data_and_topo_2_19.csv")

ulb.ts <- brush %>% filter(shed == "ULB")
mul.ts <- brush %>% filter(shed == "MUL")
rmo.ts <- brush %>% filter(shed == "RMO")
gg.ts <- brush %>% filter(shed == "GG")
#ulb
rmo.ts.plot <- ggplot(data = rmo.ts)+
  geom_line(aes(x = rnd.dates,
                y = temp.cor,
                
                color = site,
                linetype = type), 
            size = 1)+
  scale_linetype_manual(labels = c( "Downstream","Head"),
                        values=c("solid", "dotted"),
                        name = "Location")+
   scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  xlab(" ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))
rmo.ts.plot
#rmo
ulb.ts.plot <- ggplot(data = ulb.ts)+
  geom_line(aes(x = rnd.dates,
                y = temp.cor,
                color = site,
                linetype = type), 
            size = 1.5)+
  scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  scale_linetype_manual(values=c("solid", "dotted"),
                        name = "Location",
                        labels = c("Downstream", "Head"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))+
  guides(color = guide_legend(order = 1), 
              linetype = guide_legend(order = 2))
ulb.ts.plot 
#mul
mul.ts.plot <- ggplot(data = mul.ts)+
  geom_line(aes(x = rnd.dates,
                y = temp.cor,
                color = site,
                linetype = type), 
            size = 1.5)+
  scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  scale_linetype_manual(values=c( "dotted","solid"),
                        name = "Location",
                        labels = c("Head", "Downstream"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))
mul.ts.plot
#gg
gg.names <- data.frame("names" =c("Wind","Glacier", "Glacier","Landslide","Wind","Landslide"), 
                       "site" = c("W40","GC10","GC30","LS18","W60","LS"))
gg.ts <- gg.ts %>% inner_join(gg.names, brush, by = "site")

gg.ts.plot <- ggplot(data = gg.ts, aes(x = rnd.dates,
                y = temp.cor,
                color = site))+
  geom_line(aes(linetype = type), size = 1.5)+
  scale_color_brewer(palette = "Dark2",
                     name = "Stream")+
  scale_linetype_manual(values=c("solid", "dotted"),
                        name = "Location",
                        labels = c("Downstream", "Head"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  ylim(9, 19)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 17),
        axis.text.y = element_text(size = 17))
gg.ts.plot




#ggsave("ulb.ts.png", plot = ulb.ts.plot, width = 8, height = 5, units = c("in"))
#ggsave("mul.ts.png", plot = mul.ts.plot, width = 8, height = 5, units = c("in"))
#ggsave("rmo.ts.png", plot = rmo.ts.plot, width = 8, height = 5, units = c("in"))
#ggsave("gg.ts.png", plot = gg.ts.plot, width = 8, height = 5, units = c("in"))

```

FIGURE 1: ONE SITE FROM EACH SHED THROUGH TIME
```{r}
#making a simple plot showing diff bewteen downstream and head temps
potet <- read.csv("data.for.analysis_3_9.csv")
potet$rnd.dates <- ymd_hms(potet$rnd.dates)

#formatting time to beginning and end of deployment period
start <- mdy_hm("6-25-19 00:00")
end <- mdy_hm("7-8-19 00:00")
single.ts <- filter(potet, rnd.dates < end)%>%
  filter(rnd.dates > start)%>% 
  filter(site %in% c("ULB2", "MUL2", "WIND", "RMO3"))%>%
  select(temp.cor, rnd.dates, downT, shed)%>%
  rename(Head = temp.cor, Downstream = downT)%>%
  pivot_longer(cols = -rnd.dates, 
               names_to = "type",
               values_to = "value")

shed.breaks <- c("GG","ULB","RMO","MUL")
shed.colors <- c("firebrick4","slateblue4","sienna2","seagreen1")
#simple ts plot- show diff between head and downstream site
slide.ts.plot <- ggplot(data = noair.single.ts)+
  geom_line(aes(x = rnd.dates,
                y = value,
                linetype = type,
                color = shed))+
  scale_shape_manual(breaks = shed.breaks,
                    values = shed.shapes,
                    name = "Watershed")+
  scale_linetype_manual(values=c("twodash", "solid"),
                        name = "Location",
                        labels = c("Downstream", "Head"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  #ylim(20, 25)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 15),
        axis.text.y = element_text(size = 15),
        axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0)),
        panel.background = element_rect(fill = "transparent"), # bg of the panel
        plot.background = element_rect(fill = "transparent", color = NA), # bg of the 
        legend.background = element_rect(fill = "transparent"), # get rid of legend 
       )
slide.ts.plot

ggsave("example.ts.plot.png", 
       plot = slide.ts.plot, 
       width = 7, height = 4, 
       units = c("in"),
       bg = "transparent")
```


FIGURE 2: EXAMPLE TIMESERIES
```{r}
#making a simple plot showing diff bewteen downstream and head temps
potet <- read.csv("data.for.analysis_3_9.csv")
potet$rnd.dates <- ymd_hms(potet$rnd.dates)

#formatting time to beginning and end of deployment period
start <- mdy_hm("6-25-19 00:00")
end <- mdy_hm("7-1-19 00:00")
simple.ts <- filter(potet, rnd.dates < end)%>%
  filter(rnd.dates > start)%>% 
  filter(site == "ULB2")%>%
  select(temp.cor, rnd.dates, downT, airT)%>%
  rename(Head = temp.cor, Downstream = downT, Air = airT)%>%
  pivot_longer(cols = -rnd.dates, 
               names_to = "type",
               values_to = "value")

noair.simple.ts <- filter(simple.ts, type != "Air")
#simple ts plot- show diff between head and downstream site
slide.ts.plot <- ggplot(data = simple.ts)+
  geom_line(aes(x = rnd.dates,
                y = value,
                linetype = type), 
            size = 1.25,
            color = "dimgrey")+
  scale_linetype_manual(values=c("dotted", "twodash", "solid"),
                        name = "Location",
                        labels = c("Air", "Downstream", "Head"))+
  xlab( " ")+
  ylab("Temperature (C)")+
  #ylim(20, 25)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 15),
        axis.text.y = element_text(size = 15),
        axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0)),
        panel.background = element_rect(fill = "transparent"), # bg of the panel
        plot.background = element_rect(fill = "transparent", color = NA), # bg of the 
        legend.background = element_rect(fill = "transparent"), # get rid of legend 
       )
slide.ts.plot

ggsave("example.ts.plot.png", 
       plot = slide.ts.plot, 
       width = 7, height = 4, 
       units = c("in"),
       bg = "transparent")
```

FIGURE 3: TOPO METRICS VS TEMPS
```{r}
#making plots for story board
#use "cor_data_and_topo_2_19.csv"
pot <- read.csv("cor_data_and_topo_3_9.csv")
pot$rnd.dates <- ymd_hms(pot$rnd.dates)

#adding averages
pote <- pot%>%
  group_by(site)%>%
  summarise(avg.headtemp = mean(temp.cor, na.rm = TRUE), 
            avg.airtemp = mean(airT),
            med.headtemp = median(temp.cor, na.rm = TRUE),
            med.airtemp = median(airT))

potet <- inner_join(pot, unique(pote), by = c("site"))%>%
  distinct()

#converting topo metrics to metrics
potet <- mutate(potet, elev.mean.meters = elev.mean * 0.3048,
               uaa.m2 = UAA..ft2. * 0.3048 * 0.3048)

format.potet <- select(potet, temp.cor, rnd.dates, site, type, shed, airT, downT, slope.mean, elev.mean.meters, uaa.m2, avg.headtemp, avg.airtemp, med.headtemp, med.airtemp)

#write.csv(format.potet, file = "data.for.analysis_3_9.csv")

#plotting theme
theme_invis <- function (){
        theme(text= element_text(size=15),
              axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
              axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
              panel.background  = element_blank(),
              plot.background = element_rect(fill="transparent", colour=NA),
              legend.background = element_rect(fill="transparent", colour=NA),
              legend.key = element_rect(fill="transparent", colour=NA),
              panel.border = element_blank(), panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(), axis.line = element_line(colour = "black", 
                size = rel(1)))
}

shed.breaks <- c("GG","ULB","RMO","MUL")
shed.colors <- c("firebrick4","slateblue4","sienna2","seagreen1")
shed.shapes <- c(8,9,10,12)

#plotting slope vs avg water T
elev <- ggplot(potet, aes(x = elev.mean.meters,
                          y = med.headtemp))+
  geom_point(aes(shape = shed), size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Mean Elevation (m)",
       y = "Mean WaterT (C)")+
  scale_shape_manual(breaks = shed.breaks,
                    values = shed.shapes,
                    name = "Watershed")
elev
#slope
slope <- ggplot(potet, aes(x = slope.mean,
                          y = med.headtemp,
                          color = shed))+
  geom_point(size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Mean Slope (%)",
       y = "Mean WaterT (C)")+
  scale_color_manual(breaks = shed.breaks,
                    values = shed.colors,
                    name = "Watershed")
slope
#drainage area
drain <- ggplot(potet, aes(x = uaa.m2,
                          y = med.headtemp,
                          color = shed))+
  geom_point(size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Drainage Area (m2)",
       y = "Mean WaterT (C)")+
  scale_color_manual(breaks = shed.breaks,
                    values = shed.colors,
                    name = "Watershed")
drain

ggsave(drain, filename = "Ctopoplot1.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))
ggsave(slope, filename = "Ctopoplot2.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))
ggsave(elev, filename = "Ctopoplot3.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))



```

FIGURE 4: R2 AND COEFFICIENTS
```{r}
pred.cofs <- read.csv("pred.coeffs.3_11.csv")
pred.cofs$day <- ymd(pred.cofs$day)

#make finalized plot with r^2, and coefficients
r2.mets <- c("r2.elev", "r2.slope", "r2.uaa")
r2.data <- filter(pred.cofs, metric %in% r2.mets)


r2.plot <- ggplot(r2.data, aes(x = day, 
                               y = value))+
  geom_point(aes(color = shed))+
  facet_wrap(metric ~.)+
  theme_classic()+
  theme_invis()+
  scale_color_manual(breaks = shed.breaks,
                    values = shed.colors,
                    name = "Watershed")
r2.plot

ggsave(r2.plot, filename = "r2plot.png", bg = "transparent"
       ,width = 5, height = 3, units = c("in"))

#plot of r2 through time at the same y axis
r2.plot <- ggplot(r2.data, aes(x = day, 
                               y = value))+
  geom_point()+
  facet_wrap(metric ~.)+
  theme_classic()+
  theme_invis()
r2.plot

ggsave(r2.plot, filename = "r2plot.png", bg = "transparent"
       ,width = 5, height = 3, units = c("in"))
```

```{r}
potet$day <- date(potet$rnd.dates)
potet.dar <- select(potet, site, shed, day, avg.headtemp)
potet.dar <- unique(potet.dar)

r2.data$day <- ymd(r2.data$day)
r2.try <- left_join(r2.data, potet.dar, by = c("site", "shed", "day"))

elev.breaks <- c("GG","ULB","RMO","MUL")
elev.colors <- c("firebrick4","slateblue4","sienna2","seagreen1")
elev.labels <- c("Low", "Low/Med", "Med", "High")

r2.head <- ggplot(r2.try, aes(x = d.avg.airtemp, 
                               y = value))+
  geom_point(aes(color = shed))+
  facet_wrap(metric ~.)+
  theme_classic()+
  theme_invis()+
  labs(x = "Air Temperature (C)", y = "r^2 value")+
  scale_color_manual(breaks = elev.breaks,
                    values = elev.colors,
                    labels = elev.labels,
                    name = "Elevation")
r2.head
ggsave(r2.head, filename = "r2plot.png", bg = "transparent"
       ,width = 5, height = 3, units = c("in"))
```
```{r}
#look at each individual watershed
r2.mul <- filter(r2.try, shed == "MUL", metric == "r2.elev")

r2.mul <- arrange(r2.mul, value)

r2.mul.plot <- ggplot(r2.mul, aes(x = d.avg.airtemp, 
                               y = value))+
  geom_point(aes(color = site))+
  facet_wrap(metric ~.)+
  theme_classic()+
  theme_invis()
r2.mul.plot

r2.ulb <- filter(r2.try, shed == "ULB", site != "ULB2")
r2.ulb <- arrange(r2.ulb, d.avg.airtemp)
r2.ulb.plot <- ggplot(r2.ulb, aes(x = d.avg.airtemp, 
                               y = value))+
  geom_point(aes(color = site))+
  facet_wrap(metric ~.)+
  theme_classic()+
  theme_invis()
r2.ulb.plot
```

TOPOGRAPHIC METRICS VS WATER TEMPERATURE, COLORED BY ELEVATION
```{r}
elev.breaks <- c("GG","ULB","RMO","MUL")
elev.colors <- c("firebrick4","slateblue4","sienna2","seagreen1")
elev.labels <- c("Low", "Low/Med", "Med", "High")

elev <- ggplot(potet, aes(x = elev.mean.meters,
                          y = avg.headtemp))+
  geom_point(aes(color = shed), size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Mean Elevation (m)",
       y = "Mean WaterT (C)")+
  scale_shape_manual(breaks = elev.breaks,
                    values = elev.colors,
                    name = "Watershed")
elev
#slope
slope <- ggplot(potet, aes(x = slope.mean,
                          y = avg.headtemp,
                          color = shed))+
  geom_point(size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Mean Slope (%)",
       y = "Mean WaterT (C)")+
  scale_color_manual(values = elev.colors,
                     breaks = elev.breaks,
                    labels = elev.labels,
                    name = "Elevation")
slope
#drainage area
drain <- ggplot(potet, aes(x = uaa.m2,
                          y = med.headtemp,
                          color = shed))+
  geom_point(size = 4)+
  #geom_smooth(method = 'lm', se = FALSE)+
  theme_classic()+
  theme_invis()+
  labs(x = "Drainage Area (m2)",
       y = "Mean WaterT (C)")+
  scale_color_manual(breaks = shed.breaks,
                    values = shed.colors,
                    name = "Watershed")
drain

ggsave(drain, filename = "Ctopoplot1.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))
ggsave(slope, filename = "Ctopoplot4_28.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))
ggsave(elev, filename = "Ctopoplot3.png", bg = "transparent"
       ,width = 5, height = 4, units = c("in"))

```

SD OF TOPO METRICS
```{r}
#sd of topo metrics
topo <- read.csv("topometsfortable.csv")
sd(topo$uaa.m2)
mean(topo$uaa.m2)
```
DETERMINING PRECIP
```{r}
noa <- read.csv("Cullowheerain.csv")
gau <- read.csv("combined rain data.csv")
```

FIGURE 6: DIFF INITIAL TEMPS AT THE SAME ELEVATION
```{r}
#making a simple plot showing diff bewteen downstream and head temps
potet <- read.csv("data.for.analysis_3_9.csv")
potet$rnd.dates <- ymd_hms(potet$rnd.dates)

#formatting time to beginning and end of deployment period
start <- mdy_hm("6-25-19 00:00")
end <- mdy_hm("7-1-19 00:00")
simple.ts <- filter(potet, rnd.dates < end)%>%
  filter(rnd.dates > start)%>% 
  filter(site %in% c( "Wind", "Land"))%>%
  select(temp.cor, rnd.dates, site, elev.mean.meters, shed)%>%
  rename(Head = temp.cor)

#simple ts plot- show diff between two heads at the same elevation
slide.ts.plot <- ggplot(data = simple.ts)+
  geom_line(aes(x = rnd.dates,
                y = Head,
                color = site), 
            size = 1.25)+
  xlab( " ")+
  ylab("Temperature (C)")+
  ylim(12, 15)+
  theme_classic()+
  theme(text= element_text(size=17),
        axis.text.x = element_text(size = 15),
        axis.text.y = element_text(size = 15),
        axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0)),
        panel.background = element_rect(fill = "transparent"), # bg of the panel
        plot.background = element_rect(fill = "transparent", color = NA), # bg of the 
        legend.background = element_rect(fill = "transparent"), # get rid of legend 
       )
slide.ts.plot

ggsave("example.ts.plot.png", 
       plot = slide.ts.plot, 
       width = 7, height = 4, 
       units = c("in"),
       bg = "transparent")
```

```{r}
#mean of r2 for each topo metric
#need to also calculate
pote <- pot%>%
  group_by(site)%>%
  summarise(avg.headtemp = mean(temp.cor, na.rm = TRUE), 
            avg.airtemp = mean(airT),
            med.headtemp = median(temp.cor, na.rm = TRUE),
            med.airtemp = median(airT))

```

